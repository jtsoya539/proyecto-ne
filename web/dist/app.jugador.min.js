"use strict";function ControllerJugador(g,o,i){console.log("inicializo jugador.."),g.profile="USUARIO",g.tab="TEAM",g.view="PITCH",g.money=1e3,g.player="",g.message="Para cambiar tu capitan, usa el menu que aparece al hacer clic en un jugador.",g.modified=!1,g.substitution="",g.transfer="",g.moneyBackup="",g.jugadoresBackup={},g.jugadores={},g.misJugadoresBackup={},g.misJugadores={},g.miEquipoBackup={},g.miEquipo={nombre:"",captain:"112",subcaptain:"138",integrantes:[],transferencias:[]},g.clear=function(){g.miEquipo.transferencias=[],g.substitution="",g.transfer=""},g.reset=function(){g.modified&&(g.jugadores=angular.copy(g.jugadoresBackup),g.misJugadores=angular.copy(g.misJugadoresBackup),g.miEquipo=angular.copy(g.miEquipoBackup),g.money=angular.copy(g.moneyBackup),g.miEquipo.integrantes=[],g.clear(),g.getMiEquipo("S","S"),g.setModified(!1),console.log("backup restaurado"))},g.update=function(e){g.jugadoresBackup=angular.copy(g.jugadores),g.misJugadoresBackup=angular.copy(g.misJugadores),g.miEquipoBackup=angular.copy(g.miEquipo),g.moneyBackup=angular.copy(g.money),console.log("backup hecho")},g.setMoney=function(e){g.money+=e},g.agregarIntegrante=function(e,i,o){console.log("entro a agregar a mi equipo "+e.nm+".");var a=!1,t=!1,n="USUARIO"===g.profile&&"DEF"===g.tab;if("N"!==o&&g.money<e.pc)NeAlert("ERROR","Atencion!","Saldo insuficiente. No se puede agregar al equipo. <br>Jugador: "+e.nm);else if(n&&"S"!==i&&""===g.transfer)NeAlert("ERROR","Atencion!","Ud. no posee una transferencia pendiente.<br>Debe seleccionar un jugador de su equipo.");else{for(var s=0,r=g.misJugadores.length;s<r;s++){if((c=g.misJugadores[s]).id===e.id){t=!0,g.misJugadores.splice(s,1,e);break}if(""===c.id&&!t&&!a&&c.pos===e.pos){c=e,g.misJugadores.splice(s,1,e),a=!0;break}}if((a||t)&&(g.miEquipo.integrantes.push(e),e.mt=1),t||a||NeAlert(null,"Atencion!","No se puede agregar al equipo.<br>Jugador: "+e.nm),a){if("N"!==o&&g.setMoney(-e.pc),n){var u=e.tit;e.tit=g.transfer.tit,g.transfer.tit=u;var l=!1;for(s=0,r=g.miEquipo.transferencias.length;s<r;s++){var c;(c=g.miEquipo.transferencias[s].out).id===e.id&&(g.miEquipo.transferencias[s].out=g.transfer,l=!0)}l||g.transfer.id!==e.id&&(g.miEquipo.transferencias.push({out:g.transfer,in:e}),console.log("transferencias realizadas: "+g.miEquipo.transferencias)),g.transfer=""}n&&0===g.miEquipo.transferencias.length?g.setModified(!1):g.setModified(!0)}console.log("agregado "+a+" "+t),console.log(g.miEquipo),console.log(g.transfer)}},g.eliminarIntegrante=function(e,i){console.log("entro a eliminar de mi equipo: "+e.nm);var o=!1,a=!1,t="USUARIO"===g.profile&&"DEF"===g.tab,n=g.miEquipo.integrantes.indexOf(e);if(console.log("index: "+n),t){if(""!==g.transfer)return void NeAlert("ERROR","Atencion!","Ud. posee una transferencia pendiente.<br>Jugador: "+g.transfer.nm);g.transfer=e,console.log("transferencia pendiente: "+g.transfer.nm)}if(-1<n&&(g.miEquipo.integrantes.splice(n,1),o=!(e.mt=0)),o){for(var s=0,r=g.misJugadores.length;s<r;s++){if((c=g.misJugadores[s]).id===e.id&&(a=!0),a){var u=c.pos,l={id:"",nm:"X",ap:"X",cl:"DEF",club:"",color:c.color,pos:u,jr:"",pj:"",pt:"",pv:"",pc:"",eg:"",mt:1};g.misJugadores.splice(s,1,l),o=!0;break}}for(s=0,r=g.miEquipo.transferencias.length;s<r;s++){var c;if((c=g.miEquipo.transferencias[s].in).id===e.id){g.transfer=g.miEquipo.transferencias[s].out;var d=e.tit;e.tit=g.transfer.tit,g.transfer.tit=d,g.miEquipo.transferencias.splice(s,1),console.log("transferencia pendiente: "+g.transfer.nm)}}"N"!==i&&g.setMoney(e.pc)}else g.transfer="";g.setModified(!0),console.log("eliminado"),console.log(g.miEquipo),console.log(g.transfer)},g.verIntegrante=function(e){console.log("entro a datos de: "+e.nm),g.player=e,w3.show("#jugador")},g.cancelSubstitution=function(e){console.log("entro a cancelar una sustitucion: "+e.nm),g.substitution.id===e.id&&(g.substitution="")},g.makeSubstitution=function(e){if(console.log("entro a sustitucion: "+e.nm),""===g.substitution)g.substitution=e;else if(g.substitution.id===e.id)g.cancelSubstitution(e);else{var i=!1;if("N"===g.substitution.tit&&"S"===e.tit?(g.substitution.tit="S",e.tit="N",i=!0,g.miEquipo.captain===e.id&&(g.miEquipo.captain=g.substitution.id),g.miEquipo.subcaptain===e.id&&(g.miEquipo.subcaptain=g.substitution.id)):"S"===g.substitution.tit&&"N"===e.tit&&(g.substitution.tit="N",e.tit="S",i=!0,g.miEquipo.captain===g.substitution.id&&(g.miEquipo.captain=e.id),g.miEquipo.subcaptain===g.substitution.id&&(g.miEquipo.subcaptain=e.id)),i){for(var o=0,a=g.misJugadores.length;o<a;o++){var t=g.misJugadores[o];t.id===e.id&&(g.misJugadores[o].tit=e.tit),t.id===g.substitution.tit&&(g.misJugadores[o].tit=g.substitution.tit)}g.substitution=""}g.setModified(!0),console.log("sustitucion realizada.")}},g.enabledSubstitution=function(e){return""!==g.substitution&&g.substitution.tit!==e.tit&&("POR"===g.substitution.pos&&"POR"===e.pos||"POR"!==g.substitution.pos&&"POR"!==e.pos)},g.setCaptain=function(e){console.log("entro a setear capitan: "+e),g.miEquipo.subcaptain===e&&(g.miEquipo.subcaptain=g.miEquipo.captain),g.miEquipo.captain=e,g.setModified(!0)},g.setSubCaptain=function(e){console.log("entro a setear sub-capitan: "+e),g.miEquipo.captain===e&&(g.miEquipo.captain=g.miEquipo.subcaptain),g.miEquipo.subcaptain=e,g.setModified(!0)},g.setModified=function(e){g.modified=e,g.setReadyDefaultTeam(),g.setReadyTeam()},g.setView=function(e){g.view=e},g.setTab=function(e){console.log("entro a pestanha:"+e),console.log("modificado: "+g.modified),"DEF"===e?g.setMessage("Selecciona un maximo de 3 jugadores de un solo equipo."):"TEAM"===e?g.setMessage("Para cambiar tu capitan, usa el menu que aparece al hacer clic en un jugador."):g.setMessage(""),g.tab=e,g.reset(),g.setReadyDefaultTeam(),g.setReadyTeam()},g.setProfile=function(e){console.log("entro a perfil: "+e),"DEFAULT"===(g.profile=e)?$("#tabDef").click():"USUARIO"===e&&$("#tabTeam").click()},g.sesion={},g.getSesion=function(){$.LoadingOverlay("show"),o.post("GetDatos?ori=datos_sesion",{data:{index:!0,spaces:!1}}).then(function(e){g.sesion=e.data.sesion,console.log("imprimo sesion.."),console.log(g.sesion),$.LoadingOverlay("hide"),g.getClubes(g.sesion.torneo),g.setProfile(g.sesion.perfil)},function(e){alert("Error al intentar obtener sesion."),alert(e),$.LoadingOverlay("hide")})},g.getJugadores=function(e){$.LoadingOverlay("show"),o.post("GetDatos?ori=datos_jugadores",{data:{index:!1,spaces:!1,extraData:[{miEquipo:"N",club:""}]}}).then(function(e){g.jugadores=e.data.jugadores,g.pager={},g.setPage(1),g.getMiEquipo(null,"S"),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de los jugadores."),alert(e),$.LoadingOverlay("hide")})},g.getMisJugadores=function(e){$.LoadingOverlay("show"),o.post("GetDatos?ori=datos_jugadores",{data:{index:!1,spaces:!1,extraData:[{miEquipo:"S",club:e}]}}).then(function(e){g.misJugadores=e.data.jugadores,g.getMiEquipo(null,"S"),$.LoadingOverlay("hide")},function(e){alert("Error al intentar cargar mi equipo."),alert(e),$.LoadingOverlay("hide")})},g.clubes={},g.getClubes=function(e){$.LoadingOverlay("show"),o.post("GetDatos?ori=datos_clubes",{data:{index:!0,spaces:!1,extraData:[{torneo:e}]}}).then(function(e){g.clubes=e.data.clubes,console.log("imprimo clubes.."),console.log(g.clubes),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de los clubes."),alert(e),$.LoadingOverlay("hide")})},g.posiciones={},g.getPosiciones=function(e){$.LoadingOverlay("show"),o.post("GetDatos?ori=datos_posiciones",{data:{index:!0,spaces:!1}}).then(function(e){g.posiciones=e.data.posiciones,console.log("imprimo posiciones.."),console.log(g.posiciones),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de las posiciones."),alert(e),$.LoadingOverlay("hide")})},g.getMiEquipo=function(e,o){console.log("entro a cargar mi equipo."),angular.forEach(g.jugadores,function(e,i){1===e.mt&&g.agregarIntegrante(e,o,"N")}),"S"!==e&&g.update(g.miEquipo)},g.enviarEquipo=function(i){$.LoadingOverlay("show"),console.log("entro a eviar.."),o.post("UpdTeamUser",{data:{nombre:g.miEquipo.nombre,jugadores:g.miEquipo.integrantes}}).then(function(e){console.log("imprimo respuesta.."),console.log(e),w3.hide("#confirmTeam"),w3.hide("#confirmTransfer"),NeAlert(e.data.state,"Atencion!",e.data.message),g.update(),g.clear(),g.setModified(!1),"DEF"===i&&(g.jugadoresBackup={},g.jugadores={},g.misJugadoresBackup={},g.misJugadores={},g.getSesion(),g.getJugadores(),g.getMisJugadores()),$.LoadingOverlay("hide")},function(e){alert("Error al intentar enviar datos del nuevo equipo."),alert(e),$.LoadingOverlay("hide")})},g.readyDefaultTeam=!1,g.setReadyDefaultTeam=function(){g.readyDefaultTeam=!(g.miEquipo.integrantes.length<g.misJugadores.length)},g.readyTeam=!1,g.setReadyTeam=function(){g.readyTeam=!(g.miEquipo.integrantes.length<g.misJugadores.length||null===g.miEquipo.subcaptain||null===g.miEquipo.captain)&&g.modified},g.enviarEquipoDefault=function(){return g.readyDefaultTeam?$("#teamName").val()?void g.enviarEquipo("DEF"):(NeAlert("ERROR","Atencion!","Debe ingresar el nombre de su equipo."),!1):(NeAlert("ERROR","Atencion!","Debe seleccionar "+g.misJugadores.length+" jugadores."),!1)},g.setMessage=function(e){g.message=e},g.sort=function(e){console.log("entro a ordenar por:"+e),g.sortKey=e,g.reverse=!g.reverse},g.setPage=function(e){e<1||e>g.pager.totalPages||(g.pager=i.GetPager(g.jugadores.length,e),g.items=g.jugadores.slice(g.pager.startIndex,g.pager.endIndex+1))},console.log("inicializo aplicacion.."),g.getSesion(),g.getJugadores(),g.getMisJugadores(),g.getPosiciones()}function RouteProvider(e){e.when("/def",{templateUrl:"main_def.html"}).when("/team",{templateUrl:"main_team.html"}).when("/league",{templateUrl:"main_league.html"}).when("/score",{templateUrl:"main_score.html"}).when("/help",{templateUrl:"main_help.html"})}ProyectoNE.factory("PagerService",PagerService),ProyectoNE.controller("ControllerJugador",ControllerJugador),ProyectoNE.config(["$routeProvider",RouteProvider]),ProyectoNE.directive("ngIsolateApp",ngIsolateApp),ControllerJugador.$inject=["$scope","$http","PagerService"];