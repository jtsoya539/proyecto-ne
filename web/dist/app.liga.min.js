var appLiga=angular.module("liga",["angular.filter"]);function ControllerLiga(n,e,a,i){n.profile="",n.tab="",n.sesion={},n.leagues={},n.currentLeague="",n.rankMin=1,n.teamsPerPage=2,n.newLeague={},n.joinLeague={},n.inviteLeague={},n.setCurrentLeague=function(e){n.currentLeague=e},n.setRankMin=function(e){n.rankMin+e<n.currentLeague.cant&&(n.rankMin+=e),n.rankMin<1&&(n.rankMin=1)},n.getLeagues=function(){$.LoadingOverlay("show"),n.leagues={},e.fetchLeagues().then(function(e){n.leagues=e.data.ligas,console.log("imprimo ligas.."),console.log(e),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener ligas."),alert(e),$.LoadingOverlay("hide")})},n.leagueTeams={},n.getLeagueTeams=function(){$("#ranking2").LoadingOverlay("show",{fontawesomeResizeFactor:.4}),n.leagueTeams={},a.fetchLeagueTeams(n.currentLeague.id,n.rankMin,n.teamsPerPage).then(function(e){n.leagueTeams=e.data.ligaEquipos,console.log("imprimo equipos de la liga "+n.currentLeague.id),console.log(n.leagueTeams),$("#ranking2").LoadingOverlay("hide")},function(e){alert("Error al intentar obtener equipos."),alert(e),$("#ranking2").LoadingOverlay("hide")})},n.verRanking=function(e,a){console.log("entro a datos de: "+e.id),n.setCurrentLeague(e),n.setRankMin(a),console.log("rankMin: "+n.rankMin+" | teamsPerPage: "+n.teamsPerPage),n.getLeagueTeams(),w3.show("#ranking")},n.ocultarRanking=function(){console.log("cerrado datos de: "+n.currentLeague.id),n.leagueTeams={},n.setCurrentLeague(null),n.rankMin=1,w3.hide("#ranking")},n.enviarLiga=function(e){if(league={},"new-league"===e){if(!$("#leagueName").val())return NeAlert("ERROR","Atencion!","Debe ingresar el nombre de la nueva liga."),!1;league=n.newLeague}else if("join-league"===e){if(!$("#leagueCode").val())return NeAlert("ERROR","Atencion!","Debe ingresar el codigo de la liga."),!1;league=n.joinLeague}else if("invite-league"===e){if(!$("#leagueUser").val())return NeAlert("ERROR","Atencion!","Debe ingresar el usuario a invitar."),!1;n.inviteLeague.nombre=n.currentLeague.id,league=n.inviteLeague}console.log("entro a enviar liga.."),$.LoadingOverlay("show"),i.sendLeague(e,league).then(function(e){console.log("imprimo respuesta.."),console.log(e),w3.hide("#newLeague"),w3.hide("#joinLeague"),w3.hide("#inviteLeague"),n.newLeague={},n.joinLeague={},n.inviteLeague={},NeAlert(e.data.state,"Atencion!",e.data.message),"OK"===e.data.state&&n.getLeagues(),$.LoadingOverlay("hide")},function(e){alert("Error al intentar enviar el registro de liga."),alert(e),$.LoadingOverlay("hide")})},n.getLeagues()}appLiga.controller("ControllerLiga",ControllerLiga),ControllerLiga.$inject=["$scope","leaguesFactory","leagueTeamsFactory","leagueSend"],appLiga.factory("leaguesFactory",["$http",function(e){var a={fetchLeagues:function(){return e.post("GetDatos?ori=datos_ligas",{data:{index:!1,spaces:!1,extraData:[{misLigas:"S"}]}})}};return a}]),appLiga.factory("leagueTeamsFactory",["$http",function(i){var e={fetchLeagueTeams:function(e,a,n){return i.post("GetDatos?ori=datos_liga_equipos",{data:{index:!1,spaces:!1,extraData:[{idLiga:e,rankMin:a,equiPorPag:n}]}})}};return e}]),appLiga.factory("leagueSend",["$http",function(n){var e={sendLeague:function(e,a){return n.post("UpdLeague",{data:{index:!1,spaces:!1,action:e,liga:{torneo:"PRI-APE18",nombre:a.nombre,jornadaInicio:1,codigo:a.codigo,usuario:a.usuario}}})}};return e}]);