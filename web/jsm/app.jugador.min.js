"use strict";function ControllerJugador(e,i,o){console.log("inicializo jugador.."),e.profile="USUARIO",e.tab="TEAM",e.view="PITCH",e.money=1e3,e.player="",e.message="Para cambiar tu capitan, usa el menu que aparece al hacer clic en un jugador.",e.modified=!1,e.substitution="",e.transfer="",e.moneyBackup="",e.jugadoresBackup={},e.jugadores={},e.misJugadoresBackup={},e.misJugadores={},e.miEquipoBackup={},e.miEquipo={nombre:"",captain:"112",subcaptain:"138",integrantes:[],transferencias:[]},e.clear=function(){e.miEquipo.transferencias=[],e.substitution="",e.transfer=""},e.reset=function(){e.modified&&(e.jugadores=angular.copy(e.jugadoresBackup),e.misJugadores=angular.copy(e.misJugadoresBackup),e.miEquipo=angular.copy(e.miEquipoBackup),e.money=angular.copy(e.moneyBackup),e.miEquipo.integrantes=[],e.clear(),e.getMiEquipo("S","S"),e.setModified(!1),console.log("backup restaurado"))},e.update=function(i){e.jugadoresBackup=angular.copy(e.jugadores),e.misJugadoresBackup=angular.copy(e.misJugadores),e.miEquipoBackup=angular.copy(e.miEquipo),e.moneyBackup=angular.copy(e.money),console.log("backup hecho")},e.setMoney=function(i){e.money+=i},e.agregarIntegrante=function(i,o,a){console.log("entro a agregar a mi equipo "+i.nm+".");var t=!1,n=!1,s="USUARIO"===e.profile&&"DEF"===e.tab;if("N"!==a&&e.money<i.pc)NeAlert("ERROR","Atencion!","Saldo insuficiente. No se puede agregar al equipo. <br>Jugador: "+i.nm);else if(s&&"S"!==o&&""===e.transfer)NeAlert("ERROR","Atencion!","Ud. no posee una transferencia pendiente.<br>Debe seleccionar un jugador de su equipo.");else{for(var r=0,u=e.misJugadores.length;r<u;r++){if((d=e.misJugadores[r]).id===i.id){n=!0,e.misJugadores.splice(r,1,i);break}if(""===d.id&&!n&&!t&&d.pos===i.pos){d=i,e.misJugadores.splice(r,1,i),t=!0;break}}if((t||n)&&(e.miEquipo.integrantes.push(i),i.mt=1),n||t||NeAlert(null,"Atencion!","No se puede agregar al equipo.<br>Jugador: "+i.nm),t){if("N"!==a&&e.setMoney(-i.pc),s){var l=i.tit;i.tit=e.transfer.tit,e.transfer.tit=l;var c=!1;for(r=0,u=e.miEquipo.transferencias.length;r<u;r++){var d;(d=e.miEquipo.transferencias[r].out).id===i.id&&(e.miEquipo.transferencias[r].out=e.transfer,c=!0)}c||e.transfer.id!==i.id&&(e.miEquipo.transferencias.push({out:e.transfer,in:i}),console.log("transferencias realizadas: "+e.miEquipo.transferencias)),e.transfer=""}s&&0===e.miEquipo.transferencias.length?e.setModified(!1):e.setModified(!0)}console.log("agregado "+t+" "+n),console.log(e.miEquipo),console.log(e.transfer)}},e.eliminarIntegrante=function(i,o){console.log("entro a eliminar de mi equipo: "+i.nm);var a=!1,t=!1,n="USUARIO"===e.profile&&"DEF"===e.tab,s=e.miEquipo.integrantes.indexOf(i);if(console.log("index: "+s),n){if(""!==e.transfer)return void NeAlert("ERROR","Atencion!","Ud. posee una transferencia pendiente.<br>Jugador: "+e.transfer.nm);e.transfer=i,console.log("transferencia pendiente: "+e.transfer.nm)}if(s>-1&&(e.miEquipo.integrantes.splice(s,1),i.mt=0,a=!0),a){for(var r=0,u=e.misJugadores.length;r<u;r++){if((d=e.misJugadores[r]).id===i.id&&(t=!0),t){var l=d.pos,c={id:"",nm:"X",ap:"X",cl:"DEF",club:"",color:d.color,pos:l,jr:"",pj:"",pt:"",pv:"",pc:"",eg:"",mt:1};e.misJugadores.splice(r,1,c),a=!0;break}}for(r=0,u=e.miEquipo.transferencias.length;r<u;r++){var d;if((d=e.miEquipo.transferencias[r].in).id===i.id){e.transfer=e.miEquipo.transferencias[r].out;var g=i.tit;i.tit=e.transfer.tit,e.transfer.tit=g,e.miEquipo.transferencias.splice(r,1),console.log("transferencia pendiente: "+e.transfer.nm)}}"N"!==o&&e.setMoney(i.pc)}else e.transfer="";e.setModified(!0),console.log("eliminado"),console.log(e.miEquipo),console.log(e.transfer)},e.verIntegrante=function(i){console.log("entro a datos de: "+i.nm),e.player=i,w3.show("#jugador")},e.cancelSubstitution=function(i){console.log("entro a cancelar una sustitucion: "+i.nm),e.substitution.id===i.id&&(e.substitution="")},e.makeSubstitution=function(i){if(console.log("entro a sustitucion: "+i.nm),""===e.substitution)e.substitution=i;else if(e.substitution.id===i.id)e.cancelSubstitution(i);else{var o=!1;if("N"===e.substitution.tit&&"S"===i.tit?(e.substitution.tit="S",i.tit="N",o=!0,e.miEquipo.captain===i.id&&(e.miEquipo.captain=e.substitution.id),e.miEquipo.subcaptain===i.id&&(e.miEquipo.subcaptain=e.substitution.id)):"S"===e.substitution.tit&&"N"===i.tit&&(e.substitution.tit="N",i.tit="S",o=!0,e.miEquipo.captain===e.substitution.id&&(e.miEquipo.captain=i.id),e.miEquipo.subcaptain===e.substitution.id&&(e.miEquipo.subcaptain=i.id)),o){for(var a=0,t=e.misJugadores.length;a<t;a++){var n=e.misJugadores[a];n.id===i.id&&(e.misJugadores[a].tit=i.tit),n.id===e.substitution.tit&&(e.misJugadores[a].tit=e.substitution.tit)}e.substitution=""}e.setModified(!0),console.log("sustitucion realizada.")}},e.enabledSubstitution=function(i){return""!==e.substitution&&e.substitution.tit!==i.tit&&("POR"===e.substitution.pos&&"POR"===i.pos||"POR"!==e.substitution.pos&&"POR"!==i.pos)},e.setCaptain=function(i){console.log("entro a setear capitan: "+i),e.miEquipo.subcaptain===i&&(e.miEquipo.subcaptain=e.miEquipo.captain),e.miEquipo.captain=i,e.setModified(!0)},e.setSubCaptain=function(i){console.log("entro a setear sub-capitan: "+i),e.miEquipo.captain===i&&(e.miEquipo.captain=e.miEquipo.subcaptain),e.miEquipo.subcaptain=i,e.setModified(!0)},e.setModified=function(i){e.modified=i,e.setReadyDefaultTeam(),e.setReadyTeam()},e.setView=function(i){e.view=i},e.setTab=function(i){console.log("entro a pestanha:"+i),console.log("modificado: "+e.modified),"DEF"===i?e.setMessage("Selecciona un maximo de 3 jugadores de un solo equipo."):"TEAM"===i?e.setMessage("Para cambiar tu capitan, usa el menu que aparece al hacer clic en un jugador."):e.setMessage(""),e.tab=i,e.reset(),e.setReadyDefaultTeam(),e.setReadyTeam()},e.setProfile=function(i){console.log("entro a perfil: "+i),e.profile=i,"DEFAULT"===i?$("#tabDef").click():"USUARIO"===i&&$("#tabTeam").click()},e.sesion={},e.getSesion=function(){$.LoadingOverlay("show"),i.post("GetDatos?ori=datos_sesion",{data:{index:!0,spaces:!1}}).then(function(i){e.sesion=i.data.sesion,console.log("imprimo sesion.."),console.log(e.sesion),$.LoadingOverlay("hide"),e.getClubes(e.sesion.torneo),e.setProfile(e.sesion.perfil)},function(e){alert("Error al intentar obtener sesion."),alert(e),$.LoadingOverlay("hide")})},e.getJugadores=function(o){$.LoadingOverlay("show"),i.post("GetDatos?ori=datos_jugadores",{data:{index:!1,spaces:!1,extraData:[{miEquipo:"N",club:""}]}}).then(function(i){e.jugadores=i.data.jugadores,e.pager={},e.setPage(1),e.getMiEquipo(null,"S"),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de los jugadores."),alert(e),$.LoadingOverlay("hide")})},e.getMisJugadores=function(o){$.LoadingOverlay("show"),i.post("GetDatos?ori=datos_jugadores",{data:{index:!1,spaces:!1,extraData:[{miEquipo:"S",club:o}]}}).then(function(i){e.misJugadores=i.data.jugadores,e.getMiEquipo(null,"S"),$.LoadingOverlay("hide")},function(e){alert("Error al intentar cargar mi equipo."),alert(e),$.LoadingOverlay("hide")})},e.clubes={},e.getClubes=function(o){$.LoadingOverlay("show"),i.post("GetDatos?ori=datos_clubes",{data:{index:!0,spaces:!1,extraData:[{torneo:o}]}}).then(function(i){e.clubes=i.data.clubes,console.log("imprimo clubes.."),console.log(e.clubes),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de los clubes."),alert(e),$.LoadingOverlay("hide")})},e.posiciones={},e.getPosiciones=function(o){$.LoadingOverlay("show"),i.post("GetDatos?ori=datos_posiciones",{data:{index:!0,spaces:!1}}).then(function(i){e.posiciones=i.data.posiciones,console.log("imprimo posiciones.."),console.log(e.posiciones),$.LoadingOverlay("hide")},function(e){alert("Error al intentar obtener datos de las posiciones."),alert(e),$.LoadingOverlay("hide")})},e.getMiEquipo=function(i,o){console.log("entro a cargar mi equipo."),angular.forEach(e.jugadores,function(i,a){1===i.mt&&e.agregarIntegrante(i,o,"N")}),"S"!==i&&e.update(e.miEquipo)},e.enviarEquipo=function(o){$.LoadingOverlay("show"),console.log("entro a eviar.."),i.post("UpdTeamUser",{data:{nombre:e.miEquipo.nombre,jugadores:e.miEquipo.integrantes}}).then(function(i){console.log("imprimo respuesta.."),console.log(i),w3.hide("#confirmTeam"),w3.hide("#confirmTransfer"),NeAlert(i.data.state,"Atencion!",i.data.message),e.update(),e.clear(),e.setModified(!1),"DEF"===o&&(e.jugadoresBackup={},e.jugadores={},e.misJugadoresBackup={},e.misJugadores={},e.getSesion(),e.getJugadores(),e.getMisJugadores()),$.LoadingOverlay("hide")},function(e){alert("Error al intentar enviar datos del nuevo equipo."),alert(e),$.LoadingOverlay("hide")})},e.readyDefaultTeam=!1,e.setReadyDefaultTeam=function(){e.readyDefaultTeam=!(e.miEquipo.integrantes.length<e.misJugadores.length)},e.readyTeam=!1,e.setReadyTeam=function(){e.readyTeam=!(e.miEquipo.integrantes.length<e.misJugadores.length||null===e.miEquipo.subcaptain||null===e.miEquipo.captain)&&e.modified},e.enviarEquipoDefault=function(){return e.readyDefaultTeam?$("#teamName").val()?void e.enviarEquipo("DEF"):(NeAlert("ERROR","Atencion!","Debe ingresar el nombre de su equipo."),!1):(NeAlert("ERROR","Atencion!","Debe seleccionar "+e.misJugadores.length+" jugadores."),!1)},e.setMessage=function(i){e.message=i},e.sort=function(i){console.log("entro a ordenar por:"+i),e.sortKey=i,e.reverse=!e.reverse},e.setPage=function(i){i<1||i>e.pager.totalPages||(e.pager=o.GetPager(e.jugadores.length,i),e.items=e.jugadores.slice(e.pager.startIndex,e.pager.endIndex+1))},console.log("inicializo aplicacion.."),e.getSesion(),e.getJugadores(),e.getMisJugadores(),e.getPosiciones()}function RouteProvider(e){e.when("/def",{templateUrl:"main_def.html"}).when("/team",{templateUrl:"main_team.html"}).when("/league",{templateUrl:"main_league.html"}).when("/score",{templateUrl:"main_score.html"}).when("/help",{templateUrl:"main_help.html"})}ProyectoNE.factory("PagerService",PagerService),ProyectoNE.controller("ControllerJugador",ControllerJugador),ProyectoNE.config(["$routeProvider",RouteProvider]),ProyectoNE.directive("ngIsolateApp",ngIsolateApp),ControllerJugador.$inject=["$scope","$http","PagerService"];